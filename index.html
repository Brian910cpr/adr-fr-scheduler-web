<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>ShiftCommander â€” Beta</title>

    <!-- Point the UI at your Cloudflare Worker API -->
    <script>
      window.__API_BASE__ = 'https://adr-fr-scheduler-api.brian-9ac.workers.dev';
    </script>

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 UMD + Babel so JSX works without a build step -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tiny favicon to avoid 404 -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='16' fill='%234f46e5'/%3E%3Ctext x='50' y='60' font-size='42' text-anchor='middle' fill='white'%3ESC%3C/text%3E%3C/svg%3E" />

    <style>
      /* in-page error bar so a blank screen never hides errors */
      #errbox { display:none; position:fixed; left:0; right:0; bottom:0; background:#fee2e2; color:#7f1d1d; padding:8px 12px; border-top:1px solid #fecaca; font:12px/1.4 ui-sans-serif,system-ui; z-index:9999; }
      #errbox code { white-space:pre-wrap }
      .btn { @apply px-3 py-1 rounded border; }
    </style>
  </head>

  <body class="bg-gray-100 min-h-screen">
    <div id="root"></div>
    <div id="errbox"><strong>JS error:</strong> <code id="errmsg"></code></div>

    <script>
      // show runtime errors inline
      addEventListener('error', e => {
        const b=document.getElementById('errbox'), m=document.getElementById('errmsg');
        if (b&&m){ m.textContent=e?.message||String(e); b.style.display='block'; }
      });
      addEventListener('unhandledrejection', e => {
        const b=document.getElementById('errbox'), m=document.getElementById('errmsg');
        if (b&&m){ const r=e?.reason; m.textContent=(r&&r.message)?r.message:String(r||e); b.style.display='block'; }
      });
    </script>

    <script type="text/babel">
      const { useEffect, useMemo, useRef, useState } = React;
      const API_BASE = window.__API_BASE__ || "";

      // ---------- utils ----------
      const todayISO = () => new Date().toISOString().slice(0,10);
      const addDays = (date, n) => { const d=new Date(date); d.setDate(d.getDate()+n); return d; };
      const toISODate = (d) => d.toISOString().slice(0,10);
      const endOfMonth = (d) => new Date(d.getFullYear(), d.getMonth()+1, 0);
      const rangeDays = (start, end) => { const out=[]; let d=new Date(start); while(d<=end){ out.push(new Date(d)); d.setDate(d.getDate()+1);} return out; };
      const startOfWeekMon = (d) => { const x=new Date(d); const wd=(x.getDay()+6)%7; x.setDate(x.getDate()-wd); x.setHours(0,0,0,0); return x; };

      // ---------- availability UI ----------
      const AV = ["unset","prefer","available","no"];
      const AV_COL = { unset:"", prefer:"bg-green-200 ring-2 ring-green-500", available:"bg-yellow-200 ring-2 ring-yellow-500", no:"bg-red-200 ring-2 ring-red-500" };
      const cycle = (s)=> AV[(AV.indexOf(s??"unset")+1)%AV.length];

      // ---------- member (by number) ----------
      function useMember(){
        const [memberNo, setMemberNo] = useState(localStorage.getItem("__memberNo") || "");
        const [user, setUser] = useState(null);

        async function login(no){
          const r = await fetch(API_BASE + "/api/login", {
            method:"POST", headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ memberNo:no })
          });
          if(!r.ok) throw new Error("Login failed. Is that member # in the DB?");
          const j = await r.json();
          localStorage.setItem("__memberNo", no);
          setMemberNo(no); setUser(j.user);
        }
        function logout(){ localStorage.removeItem("__memberNo"); setMemberNo(""); setUser(null); }

        useEffect(()=>{ if(memberNo) login(memberNo).catch(()=>logout()); }, []);
        return { memberNo, user, login, logout, setMemberNo };
      }

      // ---------- data store ----------
      function useStore(memberNo){
        const [users, setUsers] = useState([]);
        const [availability, setAvailability] = useState({});
        const [prefs, setPrefs] = useState({});
        const [shifts, setShifts] = useState({});
        const [connected, setConnected] = useState(false);
        const wsRef = useRef(null);

        async function fetchUsers(){
          const r = await fetch(API_BASE + "/api/users");
          const j = await r.json();
          setUsers(j);
        }
        async function fetchWindow(start, end){
          const r = await fetch(API_BASE + "/api/state?start="+start+"&end="+end);
          const j = await r.json();
          setShifts(j.shifts||{}); setAvailability(j.availability||{}); setPrefs(j.prefs||{});
        }
        function openSocket(){
          try{
            const u = new URL(API_BASE);
            u.protocol = (u.protocol==="https:")?"wss:":"ws:"; u.pathname="/ws"; u.search=""; u.hash="";
            const ws = new WebSocket(u.toString()); wsRef.current = ws;
            ws.addEventListener("open", ()=> setConnected(true));
            ws.addEventListener("close", ()=> setConnected(false));
            ws.addEventListener("message", ()=>{
              const s = toISODate(new Date()); const e = toISODate(addDays(new Date(), 60));
              fetchWindow(s,e); fetchUsers();
            });
          }catch{}
        }

        // optimistic UI + 3s auto-commit
        const pending = useRef(new Map());
        async function setAvailabilityCell(userId, date, half, state){
          setAvailability(prev => {
            const p = { ...(prev[userId]||{}) };
            const v = { AM:"unset", PM:"unset", ...(p[date]||{}) }; v[half]=state; p[date]=v;
            return { ...prev, [userId]: p };
          });
          const key = userId+"|"+date+"|"+half;
          if (pending.current.get(key)) clearTimeout(pending.current.get(key));
          pending.current.set(key, setTimeout(async ()=>{
            await fetch(API_BASE + "/api/availability", {
              method:"POST",
              headers:{ "Content-Type":"application/json", "x-member": memberNo||"" },
              body: JSON.stringify({ userId, date, half, state })
            });
            pending.current.delete(key);
          }, 3000));
        }

        async function savePrefs(userId, patch){
          await fetch(API_BASE + "/api/prefs", {
            method:"POST", headers:{ "Content-Type":"application/json", "x-member": memberNo||"" },
            body: JSON.stringify({ userId, ...patch })
          });
        }

        useEffect(()=>{
          fetchUsers();
          const s = toISODate(new Date()); const e = toISODate(addDays(new Date(), 60));
          fetchWindow(s, e);
          openSocket();
          return ()=> wsRef.current?.close();
        },[]);

        return { users, availability, prefs, shifts, connected,
                 actions:{ setAvailabilityCell, savePrefs, fetchUsers, fetchWindow } };
      }

      // ---------- UI bits ----------
      function Month({ year, month, renderCell, headerRight }){
        const first = new Date(year, month, 1);
        const last = endOfMonth(first);
        const days = rangeDays(first, last);
        const startPad = (first.getDay()+6)%7; // Monday first
        const total = Math.ceil((startPad + days.length)/7)*7;
        const cells = Array.from({length:total}, (_,i)=>{ const idx=i-startPad; return (idx>=0 && idx<days.length)? days[idx]: null; });

        return (
          <div className="bg-white rounded-2xl shadow p-4">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-lg font-semibold">{first.toLocaleString(undefined,{month:"long",year:"numeric"})}</h3>
              {headerRight}
            </div>
            <div className="grid grid-cols-7 gap-2 text-xs font-semibold text-gray-500">
              {["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(d=> <div key={d} className="text-center">{d}</div>)}
            </div>
            <div className="grid grid-cols-7 gap-2 mt-2">
              {cells.map((d,i)=> (
                <div key={i} className={"min-h-[86px] border rounded-xl p-1 "+(d?"bg-gray-50":"bg-transparent border-none")}>
                  {d && (
                    <div className="flex flex-col gap-1 h-full">
                      <div className="flex items-center justify-between">
                        <span className="text-xs font-medium">{d.getDate()}</span>
                        <span className={"w-2 h-2 rounded-full "+(toISODate(d)===todayISO()?"bg-blue-500":"bg-transparent")} />
                      </div>
                      <div className="flex-1">{renderCell(d)}</div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        );
      }

      const AvBtn = ({ value, onChange, label }) => (
        <button
          className={"w-10 h-8 rounded text-xs font-medium border border-gray-300 " + (AV_COL[value || "unset"] || "")}
          onClick={()=> onChange(cycle(value))}
          title={`${label}: ${value||"unset"}`}
        >
          {label}
        </button>
      );

      // ---------- User view ----------
      function UserView({ store, member }){
        const { users, availability, prefs, actions } = store;
        const [monthsAhead, setMonthsAhead] = useState(2);
        const [offset, setOffset] = useState(0);

        const me = useMemo(()=>{
          if (!users.length) return null;
          if (!member.user) return users[0]; // fallback if not signed in
          return users.find(u=> u.id === member.user.id) || users[0];
        },[users, member.user]);

        const start = useMemo(()=> new Date(new Date().getFullYear(), new Date().getMonth()+offset, 1), [offset]);
        const months = useMemo(()=> Array.from({length: monthsAhead}, (_,i)=>{
          const d = new Date(start.getFullYear(), start.getMonth()+i, 1);
          return { year:d.getFullYear(), month:d.getMonth() };
        }), [monthsAhead, start]);

        const av = me ? (availability[me.id] || {}) : {};
        const myPrefs = me ? (prefs[me.id] || { prefer24s:false, notes:"" }) : { prefer24s:false, notes:"" };
        const parsedNotes = (()=>{ try{ return JSON.parse(myPrefs.notes||"{}"); }catch{ return {}; }})();
        const avoid = new Set(parsedNotes.avoid || []);
        const typeIII = !!parsedNotes.typeIII;
        const inactive = !!parsedNotes.inactive;
        const preCommit = (d)=> ((d - new Date())/(1000*60*60*24)) > 28;

        function patchPrefsLocally(patch){
          if (!me) return;
          const next = { ...myPrefs, ...patch };
          store.prefs = { ...store.prefs, [me.id]: next };
        }
        async function setPrefer24s(on){ if(!me) return; patchPrefsLocally({prefer24s:!!on}); await actions.savePrefs(me.id,{prefer24s:!!on}); }
        async function setTypeIII(on){ if(!me) return; const notes=JSON.stringify({ ...parsedNotes, typeIII:!!on}); patchPrefsLocally({notes}); await actions.savePrefs(me.id,{notes}); }
        async function setAvoid(uid,on){ if(!me) return; const arr=[...avoid]; const next=on?[...new Set(arr.concat(uid))]:arr.filter(x=>x!==uid); const notes=JSON.stringify({...parsedNotes,avoid:next}); patchPrefsLocally({notes}); await actions.savePrefs(me.id,{notes}); }
        async function setInactive(on){ if(!me) return; const notes=JSON.stringify({ ...parsedNotes, inactive:!!on}); patchPrefsLocally({notes}); await actions.savePrefs(me.id,{notes}); }

        // ----- default future from chosen start date -----
        const [defaultStart, setDefaultStart] = useState(todayISO());
        async function setDefaultFuture(state){
          if (!me) return;
          const msg = state==="no"
            ? `Set ALL AM/PM to Do Not starting ${defaultStart}?`
            : `Set ALL AM/PM to Available starting ${defaultStart}?`;
          if (!confirm(msg)) return;

          const begin = new Date(defaultStart);
          for (let i=0;i<180;i++){ // ~6 months
            const d = new Date(begin.getFullYear(), begin.getMonth(), begin.getDate()+i);
            const k = toISODate(d);
            await actions.setAvailabilityCell(me.id, k, "AM", state);
            await actions.setAvailabilityCell(me.id, k, "PM", state);
          }
          alert("Default applied to future days.");
        }

        // ----- weekly pattern repeater -----
        const [patternWeekStart, setPatternWeekStart] = useState(todayISO());
        const [repeatUntil, setRepeatUntil] = useState(toISODate(addDays(new Date(), 90)));
        async function repeatWeekForward(){
          if (!me) return;
          const startDate = startOfWeekMon(new Date(patternWeekStart));
          const endDate = new Date(repeatUntil); endDate.setHours(0,0,0,0);
          // capture pattern (Mon..Sun)
          const pattern = []; // [{AM:"...", PM:"..."} * 7]
          for (let i=0;i<7;i++){
            const k = toISODate(addDays(startDate, i));
            const v = av[k] || { AM:"unset", PM:"unset" };
            pattern.push({ AM:v.AM, PM:v.PM });
          }
          // roll forward week-by-week
          let cursor = new Date(startDate);
          cursor.setDate(cursor.getDate()+7); // start after the source week
          while (cursor <= endDate){
            for (let i=0;i<7;i++){
              const day = addDays(cursor, i);
              if (day > endDate) break;
              const k = toISODate(day);
              const p = pattern[i];
              await actions.setAvailabilityCell(me.id, k, "AM", p.AM);
              await actions.setAvailabilityCell(me.id, k, "PM", p.PM);
            }
            cursor.setDate(cursor.getDate()+7);
          }
          alert("Weekly pattern applied forward.");
        }

        if (!me) return <div className="text-sm text-gray-500">Loadingâ€¦</div>;

        return (
          <div className="space-y-4">
            <div className="flex flex-wrap items-center gap-3">
              <div className="text-sm">Logged in as: <span className="font-semibold">{member.user?.name || me.name}</span></div>
              <div className="ml-auto flex items-center gap-2 text-xs">
                <span className="inline-flex items-center gap-1"><span className="w-3 h-3 bg-green-300 rounded"></span>Prefer</span>
                <span className="inline-flex items-center gap-1"><span className="w-3 h-3 bg-yellow-300 rounded"></span>Available</span>
                <span className="inline-flex items-center gap-1"><span className="w-3 h-3 bg-red-300 rounded"></span>Do Not</span>
              </div>
            </div>

            <div className="flex items-center gap-2">
              <button className="px-3 py-1 rounded bg-white border" onClick={()=> setOffset(o=> o-1)}>â—€ Prev</button>
              <label className="text-sm">Months shown</label>
              <input type="number" min="1" max="6" className="w-16 border rounded px-2 py-1" value={monthsAhead} onChange={e=> setMonthsAhead(Number(e.target.value||1))} />
              <button className="px-3 py-1 rounded bg-white border" onClick={()=> setOffset(o=> o+1)}>Next â–¶</button>

              <div className="ml-auto text-xs text-gray-600">Dates > 4 weeks are Pre-commit until Manager lock.</div>
            </div>

            <div className="grid grid-cols-1 xl:grid-cols-2 gap-4">
              {months.map(({year, month})=> (
                <Month key={year+'-'+month} year={year} month={month}
                  renderCell={(d)=>{
                    const k = toISODate(d);
                    const v = av[k] || { AM:"unset", PM:"unset" };
                    const pc = preCommit(d);
                    const disable = inactive;
                    const showAM = disable ? "no" : v.AM;
                    const showPM = disable ? "no" : v.PM;
                    return (
                      <div className="flex items-center justify-between gap-2">
                        <div className="flex items-center gap-2">
                          <AvBtn label="AM" value={showAM} onChange={(s)=> !disable && actions.setAvailabilityCell(me.id, k, "AM", s)} />
                          <AvBtn label="PM" value={showPM} onChange={(s)=> !disable && actions.setAvailabilityCell(me.id, k, "PM", s)} />
                        </div>
                        {pc && <span className="text-[10px] uppercase px-2 py-1 rounded-full bg-purple-100 border border-purple-300">Pre-commit</span>}
                      </div>
                    );
                  }}
                />
              ))}
            </div>

            <details className="rounded-2xl bg-white p-4 shadow">
              <summary className="cursor-pointer font-semibold">Preferences & bulk tools</summary>
              <div className="mt-3 grid gap-4">
                <div className="grid sm:grid-cols-2 gap-3">
                  <label className="inline-flex items-center gap-2">
                    <input type="checkbox" checked={!!myPrefs.prefer24s} onChange={e=> setPrefer24s(e.target.checked)} />
                    Prefer 24s
                  </label>
                  <label className="inline-flex items-center gap-2">
                    <input type="checkbox" checked={typeIII} onChange={e=> setTypeIII(e.target.checked)} />
                    Type III driver approved
                  </label>
                  <label className="inline-flex items-center gap-2">
                    <input type="checkbox" checked={!!inactive} onChange={e=> setInactive(e.target.checked)} />
                    Inactive (block new scheduling)
                  </label>
                </div>

                <div>
                  <div className="text-sm font-medium mb-1">Avoid co-workers (backup list)</div>
                  <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                    {users.filter(u=> me && u.id!==me.id).map(u=> (
                      <label key={u.id} className="inline-flex items-center gap-2 text-sm bg-gray-50 border rounded px-2 py-1">
                        <input type="checkbox" checked={avoid.has(u.id)} onChange={e=> setAvoid(u.id, e.target.checked)} />
                        {u.name}
                      </label>
                    ))}
                  </div>
                </div>

                <div className="grid md:grid-cols-2 gap-4 border-t pt-4">
                  <div className="space-y-2">
                    <div className="text-sm font-semibold">Set future dates toâ€¦ (from date)</div>
                    <div className="flex items-center gap-2">
                      <input type="date" className="border rounded px-2 py-1" value={defaultStart} onChange={e=> setDefaultStart(e.target.value)} />
                      <button className="px-3 py-1 rounded bg-red-100 border border-red-300 text-red-700" onClick={()=> setDefaultFuture("no")}>Do Not (all AM/PM)</button>
                      <button className="px-3 py-1 rounded bg-yellow-100 border border-yellow-300 text-yellow-800" onClick={()=> setDefaultFuture("available")}>Available (all AM/PM)</button>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <div className="text-sm font-semibold">Repeat 1-week pattern forward</div>
                    <div className="grid sm:grid-cols-3 gap-2 items-center">
                      <label className="text-xs text-gray-600">Source week (Mon):</label>
                      <input type="date" className="border rounded px-2 py-1 sm:col-span-2" value={patternWeekStart} onChange={e=> setPatternWeekStart(e.target.value)} />
                      <label className="text-xs text-gray-600">Repeat until:</label>
                      <input type="date" className="border rounded px-2 py-1 sm:col-span-2" value={repeatUntil} onChange={e=> setRepeatUntil(e.target.value)} />
                      <div className="sm:col-span-3">
                        <button className="px-3 py-1 rounded bg-blue-600 text-white" onClick={repeatWeekForward}>Apply</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </details>
          </div>
        );
      }

      // ---------- Supervisor view ----------
      function SupervisorView({ store }){
        const { users = [], prefs = {}, shifts = {}, actions } = store;
        const [name, setName] = useState("");
        const [role, setRole] = useState("EMT");
        const [memberNo, setMemberNo] = useState("");

        async function addUser(){
          if (!name || !role) return alert("Name and role required.");
          const body = { name, role, can_drive: [], notes: "", member_no: memberNo || undefined };
          const r = await fetch(window.__API_BASE__ + "/api/users", {
            method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(body)
          });
          if (!r.ok){ alert("Add failed"); return; }
          setName(""); setRole("EMT"); setMemberNo("");
          await actions.fetchUsers();
        }

        function userInactive(u){
          const p = prefs[u.id] || {};
          try { return !!JSON.parse(p.notes||"{}").inactive; } catch { return false; }
        }
        async function setInactive(u, on){
          const p = prefs[u.id] || { notes:"" };
          let notes = {};
          try { notes = JSON.parse(p.notes||"{}"); } catch {}
          notes.inactive = !!on;
          await actions.savePrefs(u.id, { notes: JSON.stringify(notes) });
        }

        // quick glance next 60 days
        const glance = useMemo(()=>{
          const s = new Date(); const e = addDays(s, 60);
          let unassigned = 0, proposed = 0, approved = 0;
          let cursor = new Date(s);
          while (cursor <= e){
            const k = toISODate(cursor);
            const halves = shifts[k] || {};
            for (const half of ["AM","PM"]){
              const st = halves[half]?.status || "unassigned";
              if (st==="unassigned") unassigned++;
              else if (st==="proposed") proposed++;
              else if (st==="approved") approved++;
            }
            cursor.setDate(cursor.getDate()+1);
          }
          return { unassigned, proposed, approved };
        }, [shifts]);

        return (
          <div className="space-y-4">
            <div className="bg-white rounded-2xl p-4 shadow">
              <div className="font-semibold mb-2">Add Member</div>
              <div className="grid grid-cols-1 sm:grid-cols-5 gap-2">
                <input className="border rounded px-2 py-1" placeholder="Name" value={name} onChange={e=> setName(e.target.value)} />
                <select className="border rounded px-2 py-1" value={role} onChange={e=> setRole(e.target.value)}>
                  <option>EMT</option><option>Driver</option><option>ALS</option>
                </select>
                <input className="border rounded px-2 py-1" placeholder="Member #" value={memberNo} onChange={e=> setMemberNo(e.target.value)} />
                <button className="px-3 py-1 rounded bg-blue-600 text-white" onClick={addUser}>Add</button>
                <div className="text-xs text-gray-500 self-center">Members appear immediately after add.</div>
              </div>
            </div>

            <div className="bg-white rounded-2xl p-4 shadow">
              <div className="font-semibold mb-2">Next 60 days â€” status glance</div>
              <div className="flex gap-3 text-sm">
                <span className="px-2 py-1 rounded bg-gray-100">Unassigned: <b>{glance.unassigned}</b></span>
                <span className="px-2 py-1 rounded bg-yellow-100">Proposed: <b>{glance.proposed}</b></span>
                <span className="px-2 py-1 rounded bg-emerald-100">Approved: <b>{glance.approved}</b></span>
              </div>
            </div>

            <div className="bg-white rounded-2xl p-4 shadow">
              <div className="font-semibold mb-2">Roster</div>
              <div className="divide-y">
                {users.map(u=> (
                  <div key={u.id} className="py-2 flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <div className={"w-2 h-2 rounded-full "+(userInactive(u)?"bg-red-500":"bg-emerald-500")} />
                      <div className="font-medium">{u.name}</div>
                      <div className="text-xs text-gray-500">{u.role}</div>
                      <div className="text-xs text-gray-500">#{u.member_no || "â€”"}</div>
                    </div>
                    <div className="flex items-center gap-3">
                      <label className="text-sm inline-flex items-center gap-2">
                        <input type="checkbox" checked={userInactive(u)} onChange={e=> setInactive(u, e.target.checked)} />
                        Inactive
                      </label>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      }

      // ---------- App ----------
      function NavTab({ id, current, label, set }) {
        const active = current === id;
        return (
          <button
            type="button"
            className={
              "px-4 py-2 rounded-2xl text-sm font-medium border " +
              (active ? "bg-blue-600 text-white border-blue-600" : "bg-white border-gray-300")
            }
            onClick={() => set(id)}
            aria-pressed={active}
            aria-current={active ? "page" : undefined}
          >
            {label}
          </button>
        );
      }

      function App(){
        const member = useMember();
        const store = useStore(member.memberNo);
        const [tab, setTab] = useState("user");
        const [inputNo, setInputNo] = useState("");

        return (
          <div>
            <header className="sticky top-0 z-40 bg-white/80 backdrop-blur border-b">
              <div className="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
                <div className="font-bold text-lg tracking-tight">ShiftCommander</div>
                <div className={"ml-2 text-xs px-2 py-1 rounded-full border " + (store.connected?"border-emerald-300 bg-emerald-50":"border-gray-300 bg-gray-50")}>
                  {store.connected?"Live":"Offline"}
                </div>
                <div className="ml-auto flex items-center gap-2">
                  {!member.user ? (
                    <>
                      <input className="border rounded px-2 py-1 text-sm" placeholder="Member #" value={inputNo} onChange={e=> setInputNo(e.target.value)} />
                      <button className="px-3 py-1 rounded bg-blue-600 text-white text-sm" onClick={()=> member.login(inputNo)}>Sign in</button>
                    </>
                  ) : (
                    <div className="flex items-center gap-3 text-sm">
                      <span className="px-2 py-1 bg-gray-100 rounded">{member.user.name} â€¢ {member.user.role} â€¢ #{member.user.member_no||"â€”"}</span>
                      <button className="px-2 py-1 rounded bg-gray-200" onClick={member.logout}>Sign out</button>
                    </div>
                  )}
                  <NavTab id="user" current={tab} label="User View" set={setTab} />
                  <NavTab id="super" current={tab} label="Supervisor" set={setTab} />
                </div>
              </div>
            </header>

            <main className="max-w-7xl mx-auto p-4">
              {tab==="user" && <UserView store={store} member={member} />}
              {tab==="super" && <SupervisorView store={store} />}
              <footer className="mt-10 text-xs text-gray-500">
                <div>AM/PM toggles auto-commit after 3s. Dates &gt; 4 weeks show Pre-commit until a supervisor locks the schedule.</div>
              </footer>
            </main>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
