<!-- supervisor.html — Week-at-a-glance calendar with arrows; Month view toggle; Options restored -->
<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ShiftCommander · Supervisor</title>
<style>
:root{--bg:#0d1117;--panel:#161b22;--ink:#e6edf3;--muted:#8b949e;--line:#2a2f37;--accent:#58a6ff}
html,body{background:var(--bg);color:var(--ink);margin:0;font:14px/1.4 system-ui,Segoe UI,Roboto,Arial}
.wrap{max-width:1200px;margin:20px auto;padding:0 12px}
header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
select,button,input{background:var(--panel);border:1px solid var(--line);color:var(--ink);border-radius:10px;padding:8px 10px}
.board{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:12px}
.grid7{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
.day{border:1px dashed #2b313a;border-radius:12px;padding:10px;min-height:120px}
.date{font-weight:800;font-size:18px;margin-bottom:6px}
.slot{display:flex;gap:8px;align-items:center;margin:4px 0}
.badge{background:#1b2430;border:1px solid var(--line);border-radius:999px;padding:2px 8px;font-weight:700}
.names{font-weight:700}
.optCard{margin-top:12px;background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px}
.leg{color:var(--muted);font-size:12px;margin-top:6px}
</style>
</head><body><div class="wrap">
  <header>
    <h2 style="margin:0">ShiftCommander <span style="color:var(--muted)">Supervisor</span></h2>
    <button id="prev">◀</button><div id="label" style="min-width:200px;text-align:center"></div><button id="next">▶</button>
    <label style="margin-left:10px"><input type="checkbox" id="monthToggle"> Month at a glance</label>
  </header>

  <section class="board">
    <div id="grid" class="grid7"></div>
    <div class="leg">Week view scrolls by 7-day blocks; Month view shows a 6-row calendar.</div>
  </section>

  <section class="optCard">
    <h3 style="margin:0 0 6px 0">Options</h3>
    <div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center">
      <label>Jump to week starting <input type="date" id="jump"></label>
      <button id="jumpBtn">Go</button>
    </div>
  </section>
</div>

<script>
const API = p => `https://adr-fr-scheduler-api.brian-9ac.workers.dev${p}`;
const fmt = d => d.toISOString().slice(0,10);
const label = d => d.toLocaleDateString(undefined,{weekday:'short', month:'short', day:'numeric'});

let users = [], id2name = {};
let cursor = new Date(); // week start (Mon)
cursor.setDate(cursor.getDate() - ((cursor.getDay()+6)%7));

function monFirst(d){ return (d.getDay()+6)%7; }
function monthBounds(dt){
  const first = new Date(dt.getFullYear(), dt.getMonth(), 1);
  const start = new Date(first); start.setDate(first.getDate()-monFirst(first));
  const end = new Date(start); end.setDate(start.getDate()+41);
  return {start,end};
}

async function loadUsers(){ users = await (await fetch(API('/api/users'))).json(); id2name = Object.fromEntries(users.map(u=>[u.id,u.name])); }

async function loadState(start,end){
  const res = await fetch(API(`/api/state?start=${fmt(start)}&end=${fmt(end)}`));
  return await res.json();
}

function renderWeek(data){
  const grid = document.getElementById('grid');
  grid.className = 'grid7';
  const cells = [];
  for(let i=0;i<7;i++){
    const d = new Date(cursor); d.setDate(cursor.getDate()+i);
    const ymd = fmt(d);
    const s = data.shifts?.[ymd] || {};
    const am = (s.AM?.assignees||[]).map(id=>id2name[id]).join(", ");
    const pm = (s.PM?.assignees||[]).map(id=>id2name[id]).join(", ");
    cells.push(`
      <div class="day">
        <div class="date">${label(d)}</div>
        <div class="slot"><span class="badge">AM</span> <span class="names">${am || '—'}</span></div>
        <div class="slot"><span class="badge">PM</span> <span class="names">${pm || '—'}</span></div>
      </div>
    `);
  }
  grid.innerHTML = cells.join('');
  document.getElementById('label').textContent =
    `${label(cursor)} → ${label(new Date(cursor.getFullYear(),cursor.getMonth(),cursor.getDate()+6))}`;
}

function renderMonth(data){
  const grid = document.getElementById('grid');
  grid.className = 'grid7';
  const base = new Date(cursor.getFullYear(), cursor.getMonth(), 1);
  const {start} = monthBounds(base);
  const cells = [];
  for(let i=0;i<42;i++){
    const d = new Date(start); d.setDate(start.getDate()+i);
    const ymd = fmt(d);
    const s = data.shifts?.[ymd] || {};
    const am = (s.AM?.assignees||[]).map(id=>id2name[id]).join(", ");
    const pm = (s.PM?.assignees||[]).map(id=>id2name[id]).join(", ");
    const op = d.getMonth()===base.getMonth()?1:.45;
    cells.push(`
      <div class="day" style="opacity:${op}">
        <div class="date">${d.getDate()}</div>
        <div class="slot"><span class="badge">AM</span> <span class="names">${am || '—'}</span></div>
        <div class="slot"><span class="badge">PM</span> <span class="names">${pm || '—'}</span></div>
      </div>
    `);
  }
  grid.innerHTML = cells.join('');
  document.getElementById('label').textContent =
    base.toLocaleString(undefined,{month:'long',year:'numeric'});
}

async function draw(){
  const monthMode = document.getElementById('monthToggle').checked;
  if (monthMode){
    const base = new Date(cursor.getFullYear(),cursor.getMonth(),1);
    const {start,end} = monthBounds(base);
    const data = await loadState(start,end);
    renderMonth(data);
  } else {
    const start = new Date(cursor);
    const end = new Date(cursor); end.setDate(start.getDate()+6);
    const data = await loadState(start,end);
    renderWeek(data);
  }
}

document.getElementById('prev').onclick = async ()=>{
  if (document.getElementById('monthToggle').checked){
    cursor = new Date(cursor.getFullYear(), cursor.getMonth()-1, 1);
  } else {
    cursor.setDate(cursor.getDate()-7);
  }
  await draw();
};
document.getElementById('next').onclick = async ()=>{
  if (document.getElementById('monthToggle').checked){
    cursor = new Date(cursor.getFullYear(), cursor.getMonth()+1, 1);
  } else {
    cursor.setDate(cursor.getDate()+7);
  }
  await draw();
};
document.getElementById('monthToggle').onchange = draw;
document.getElementById('jumpBtn').onclick = async ()=>{
  const v = (document.getElementById('jump').value)||"";
  if (!v) return;
  const d = new Date(v);
  d.setDate(d.getDate() - ((d.getDay()+6)%7));
  cursor = d; await draw();
};

(async function(){ await loadUsers(); await draw(); })();
</script>
</body></html>
