<!-- supervisor.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ShiftCommander · Supervisor</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{--bg:#0d1117;--panel:#161b22;--ink:#e6edf3;--muted:#8b949e;--line:#2a2f37;--ok:#0b5}
  html,body{background:var(--bg);color:var(--ink);margin:0;font:14px/1.4 system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:1100px;margin:24px auto;padding:0 12px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:14px;margin-bottom:14px}
  h2{margin:0 0 8px 0}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-top:1px solid var(--line)}
  th{color:var(--muted);text-align:left}
  .date{font-weight:700;font-size:16px}
  .name{font-weight:700;font-size:16px}
</style>
</head>
<body>
<div class="wrap">
  <h2>ShiftCommander <span style="color:var(--muted);font-weight:500">Supervisor</span></h2>

  <div class="card">
    <h3>Notes (member → supervisor) <span id="range" style="color:var(--muted)"></span></h3>
    <div id="noteTable">Loading…</div>
  </div>

  <div class="card">
    <h3>Staffing, next 14 days</h3>
    <div id="grid">Loading…</div>
  </div>
</div>
<script>
const API = (p)=>`https://adr-fr-scheduler-api.brian-9ac.workers.dev${p}`;

function fmtDate(d){return d.toISOString().slice(0,10)}
function label(d){
  return d.toLocaleDateString(undefined,{weekday:'short', month:'short', day:'numeric'});
}

async function loadNotes(){
  const start = new Date(); const end = new Date(); end.setDate(start.getDate()+6);
  document.getElementById('range').textContent = `(${fmtDate(start)} → ${fmtDate(end)})`;
  const res = await fetch(API(`/api/notes?start=${fmtDate(start)}&end=${fmtDate(end)}`));
  if(!res.ok){ document.getElementById('noteTable').textContent = "Notes API not available."; return; }
  const data = await res.json();
  const rows = (data.notes||[]).map(n=>`
    <tr>
      <td class="date">${label(new Date(n.date))}</td>
      <td>${n.half}</td>
      <td class="name">${n.user_name}</td>
      <td>${n.note}</td>
    </tr>
  `).join('');
  document.getElementById('noteTable').innerHTML = `
    <table>
      <thead><tr><th>Date</th><th>Half</th><th>Member</th><th>Note</th></tr></thead>
      <tbody>${rows || `<tr><td colspan="4" style="color:#8b949e">No notes this period.</td></tr>`}</tbody>
    </table>`;
}

async function loadStaffing(){
  const start = new Date(); const end = new Date(); end.setDate(start.getDate()+13);
  const res = await fetch(API(`/api/state?start=${fmtDate(start)}&end=${fmtDate(end)}`));
  const data = await res.json();
  const days = [];
  for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){
    const ymd = fmtDate(d);
    const row = data.shifts?.[ymd] || {};
    const am = (row.AM?.assignees||[]).length;
    const pm = (row.PM?.assignees||[]).length;
    days.push(`<tr><td class="date">${label(d)}</td><td>${am}</td><td>${pm}</td></tr>`);
  }
  document.getElementById('grid').innerHTML = `
    <table>
      <thead><tr><th>Date</th><th>AM signed</th><th>PM signed</th></tr></thead>
      <tbody>${days.join('')}</tbody>
    </table>`;
}

(async function(){ await loadNotes(); await loadStaffing(); })();
</script>
</body>
</html>
