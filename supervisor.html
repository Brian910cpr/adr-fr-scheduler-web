<!-- supervisor.html â€” paste this just before </body> -->
<script>
/* Reuse SCHED client if present */
if(!window.SCHED){
  window.SCHED=(function(){
    const API="https://adr-fr-scheduler-api.brian-9ac.workers.dev";
    async function fetchState({start,end}){ const r=await fetch(`${API}/api/state?start=${start}&end=${end}`); if(!r.ok)throw new Error("state fetch failed"); return r.json(); }
    async function health(){ const r=await fetch(`${API}/api/health`); return r.json(); }
    return {fetchState, health};
  })();
}
</script>
<script>
// ================= SUPERVISOR (calendar) WIRING ======================
// No layout changes; fill seats and enlarge date text a bit.

(function(){
  const MAX_SEATS = 4;

  const style = document.createElement("style");
  style.textContent = `
    .day .date-num, .day .dow { font-size: clamp(18px, 2.2vw, 28px); font-weight:700; }
    .seat-line { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .note-dot { display:inline-block; width:8px; height:8px; border-radius:50%; vertical-align:middle; margin-left:6px; }
  `;
  document.head.appendChild(style);

  function idToName(id){ return (window.USER_LABELS && window.USER_LABELS[id]) || id; }

  function renderSeats(halfBox, ids){
    const list = halfBox.querySelector(".seats") || document.createElement("div");
    list.className = "seats";
    list.innerHTML = "";
    (ids||[]).slice(0,MAX_SEATS).forEach(id=>{
      const line = document.createElement("div");
      line.className = "seat-line";
      line.textContent = idToName(id);
      list.appendChild(line);
    });
    if(!halfBox.querySelector(".seats")) halfBox.appendChild(list);
  }

  function paintNoteDot(halfBox, has){
    let dot = halfBox.querySelector(".note-dot");
    if(!dot){ dot = document.createElement("span"); dot.className="note-dot"; halfBox.appendChild(dot); }
    dot.style.background = has ? "#000" : "transparent";
    dot.title = has ? "Note present" : "";
  }

  async function loadAndPaint(){
    const days = Array.from(document.querySelectorAll(".day[data-date]"));
    if(!days.length) return;
    const dates = days.map(d=>d.dataset.date).sort();
    const start = dates[0], end = dates[dates.length-1];

    let data;
    try{ data = await SCHED.fetchState({ start, end }); }
    catch(e){ console.error("state fetch failed", e); return; }

    days.forEach(day=>{
      const d = day.dataset.date;
      const amBox = day.querySelector(".am");
      const pmBox = day.querySelector(".pm");
      const shift = (data.shifts && data.shifts[d]) || { AM:{assignees:[]}, PM:{assignees:[]} };

      if(amBox){
        renderSeats(amBox, shift.AM.assignees||[]);
        // paintNoteDot(amBox, !!(data.notes?.[d]?.AM)); // enable when API exposes notes
      }
      if(pmBox){
        renderSeats(pmBox, shift.PM.assignees||[]);
        // paintNoteDot(pmBox, !!(data.notes?.[d]?.PM));
      }
    });
  }

  (async function(){
    try{ await SCHED.health(); }catch(e){}
    loadAndPaint();
  })();
})();
</script>
