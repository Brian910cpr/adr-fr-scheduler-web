<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ADR-FR Wallboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { margin:0; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:#0b1220; color:#e6edf3; }
h1 { padding:16px; margin:0; background:#121a2b; border-bottom:1px solid #24304c; }
#info { padding:10px 16px; color:#a3afd1; font-size:14px; }
pre { background:#121a2b; color:#86d18f; margin:16px; padding:16px; border-radius:8px;
  overflow:auto; white-space:pre-wrap; word-break:break-all; }
table { border-collapse:collapse; width:100%; color:#e6edf3; margin:16px 0; }
th,td { border:1px solid #24304c; padding:6px 10px; text-align:center; }
th { background:#121a2b; position:sticky; top:0; }
.locked { background:#131a2a; color:#888; }
.today { background:#20325a; }
.green { background:#1b4734; }
.amber { background:#4a3c1e; }
.red { background:#3a1616; }
</style>
</head>
<body>
<h1>ADR-FR Wallboard</h1>
<div id="info">Loading…</div>
<div id="board"></div>

<script>
async function loadBoard() {
  const url = '/api/wallboard?month=' + new Date().toISOString().slice(0,7)
  const res = await fetch(url)
  if (!res.ok) {
    document.getElementById('info').textContent = 'Failed to load wallboard (' + res.status + ')'
    return
  }
  const data = await res.json()
  renderBoard(data)
}

function renderBoard(d) {
  const info = document.getElementById('info')
  info.textContent = 'Today: ' + d.today + ' | Cutoff: ' + d.cutoff + ' | ' + d.trucks.length + ' units'

  const table = document.createElement('table')
  const head = document.createElement('tr')
  head.innerHTML = '<th>Date</th>' + d.trucks.map(t => '<th>' + t + ' Day</th><th>' + t + ' Night</th>').join('')
  table.appendChild(head)

  for (let i=1; i<=d.days; i++) {
    const date = d.month + '-' + String(i).padStart(2,'0')
    const tr = document.createElement('tr')
    if (date < d.cutoff) tr.classList.add('locked')
    if (date === d.today) tr.classList.add('today')
    const day = document.createElement('td')
    day.textContent = date
    tr.appendChild(day)
    for (const t of d.trucks) {
      const dayKey = `${date}|${t}|Day`
      const nightKey = `${date}|${t}|Night`
      const dayVal = d.assignments[dayKey]?.member_name ?? '—'
      const nightVal = d.assignments[nightKey]?.member_name ?? '—'
      const td1 = document.createElement('td')
      const td2 = document.createElement('td')
      td1.textContent = dayVal
      td2.textContent = nightVal
      tr.appendChild(td1)
      tr.appendChild(td2)
    }
    table.appendChild(tr)
  }

  const board = document.getElementById('board')
  board.innerHTML = ''
  board.appendChild(table)
}

loadBoard()
</script>
</body>
</html>
