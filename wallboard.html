<!-- wallboard.html (kept bold, 4 seats per day, big date; read-only board) -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ShiftCommander • Wallboard</title>
<style>
  :root{--bg:#0b0e13;--panel:#131a22;--ring:#263445;--ink:#e8eef7;--muted:#8ea3ba;--card:#0f151c;--chip:#111822;--badge:#2b88ff}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font:15px system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--ring);background:linear-gradient(180deg,var(--panel),var(--card))}
  h1{margin:0;font-size:18px;font-weight:800}
  .wrap{padding:14px 16px}
  .row{display:grid;grid-template-columns:repeat(7,1fr);gap:12px}
  .day{background:var(--panel);border:1px solid var(--ring);border-radius:14px;padding:12px}
  .dow{color:var(--muted);font-weight:700}
  .dtitle{font-size:18px;font-weight:900;margin:6px 0 10px}
  .shift{background:var(--card);border:1px dashed var(--ring);border-radius:12px;padding:8px 10px;margin-top:8px}
  .label{font-weight:800}
  .seats{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:6px}
  .seat{background:var(--chip);border:1px solid var(--ring);border-radius:10px;padding:6px 8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .nudge{margin-top:8px;font-size:12px;background:var(--badge);padding:4px 8px;border-radius:999px;display:inline-block}
</style>
</head>
<body>
<header>
  <h1>ShiftCommander <span style="opacity:.7;margin-left:6px">Wallboard</span></h1>
</header>

<div class="wrap">
  <div id="board" class="row"></div>
</div>

<script>
(() => {
  const API = 'https://adr-fr-scheduler-api.brian-9ac.workers.dev';
  const board = document.getElementById('board');
  const iso = d=>d.toISOString().slice(0,10);
  const addDays=(d,n)=>{const c=new Date(d); c.setDate(c.getDate()+n); return c;};
  const startOfWeek=(d)=>{const c=new Date(d); const wd=(c.getDay()+6)%7; c.setDate(c.getDate()-wd); return c;};

  async function jget(u){ const r=await fetch(u); return r.json(); }

  async function load(){
    const start = startOfWeek(new Date());
    const end = addDays(start,6);
    const data = await jget(`${API}/api/state?start=${iso(start)}&end=${iso(end)}`);
    render(data, start);
  }

  function render(data, start){
    board.innerHTML='';
    let day = new Date(start);
    for(let i=0;i<7;i++){
      const dd = iso(day);
      const dEl = document.createElement('div');
      dEl.className='day';
      dEl.innerHTML = `
        <div class="dow">${day.toLocaleString(undefined,{weekday:'short'})}</div>
        <div class="dtitle">${day.toLocaleString(undefined,{month:'short',day:'numeric'})}</div>

        <div class="shift">
          <div class="label">AM</div>
          <div class="seats" id="am-${dd}">
            <div class="seat">—</div><div class="seat">—</div><div class="seat">—</div><div class="seat">—</div>
          </div>
          <div class="nudge" id="amn-${dd}">Need ALS&EMT</div>
        </div>

        <div class="shift">
          <div class="label">PM</div>
          <div class="seats" id="pm-${dd}">
            <div class="seat">—</div><div class="seat">—</div><div class="seat">—</div><div class="seat">—</div>
          </div>
          <div class="nudge" id="pmn-${dd}">Need ALS&EMT</div>
        </div>
      `;
      board.appendChild(dEl);

      ['AM','PM'].forEach(half=>{
        const ids = data.shifts?.[dd]?.[half]?.assignees || [];
        const seats = document.getElementById((half==='AM'?'am-':'pm-')+dd).children;
        ids.slice(0,4).forEach((id,idx)=>{ seats[idx].textContent = id; });
        const need = needText(ids);
        document.getElementById((half==='AM'?'amn-':'pmn-')+dd).textContent = need;
      });

      day = addDays(day,1);
    }
  }

  function needText(names){
    const hasALS = names.some(n=>/ALS/i.test(n));
    const hasEMT = names.some(n=>/EMT/i.test(n));
    if(!hasALS && !hasEMT) return 'Need ALS&EMT';
    if(!hasALS) return 'Need ALS';
    if(!hasEMT) return 'Need EMT';
    return 'OK';
  }

  load();
  setInterval(load, 30000); // refresh every 30s
})();
</script>
</body>
</html>
