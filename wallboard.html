<!-- wallboard.html (public display) -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ShiftCommander · Wallboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{--bg:#0b0f14;--ink:#e6edf3;--muted:#9aa4af;--panel:#0f141a;--line:#1f2730;--pill:#1b2430;--accent:#58a6ff}
  html,body{background:var(--bg);color:var(--ink);margin:0;font:16px/1.4 system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:1400px;margin:10px auto;padding:0 10px}
  .board{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
  .col{background:var(--panel);border:1px solid var(--line);border-radius:16px;overflow:hidden}
  .col h3{margin:0;padding:10px 12px;background:#111823;border-bottom:1px solid var(--line);font-size:18px}
  .day{padding:10px 12px;border-top:1px dashed var(--line)}
  .date{font-weight:800;font-size:20px;margin-bottom:8px}
  .slot{display:flex;gap:6px;align-items:center;margin:6px 0}
  .slot b{display:inline-block;width:42px;text-align:center;background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:4px 0}
  .names{font-weight:700}
  .empty{color:var(--muted);font-style:italic}
</style>
</head>
<body>
<div class="wrap">
  <div id="board" class="board"></div>
</div>
<script>
const API=(p)=>`https://adr-fr-scheduler-api.brian-9ac.workers.dev${p}`;
function fmtDate(d){return d.toISOString().slice(0,10)}
function label(d){return d.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'})}

async function getUsers(){ const r=await fetch(API('/api/users')); return await r.json(); }

async function getWindow(){
  const start=new Date(); const end=new Date(); end.setDate(start.getDate()+13);
  const qs=`?start=${fmtDate(start)}&end=${fmtDate(end)}`;
  const r=await fetch(API('/api/state'+qs)); return await r.json();
}

(async function(){
  const users = await getUsers();
  const id2name = Object.fromEntries(users.map(u=>[u.id,u.name]));
  const data = await getWindow();
  const start=new Date(); const cols=[[],[],[],[],[],[],[]];

  for(let i=0;i<14;i++){
    const d=new Date(start); d.setDate(start.getDate()+i);
    const ymd = fmtDate(d);
    const day = data.shifts?.[ymd] || {};
    const am = (day.AM?.assignees||[]).map(id=>id2name[id]).join(", ");
    const pm = (day.PM?.assignees||[]).map(id=>id2name[id]).join(", ");
    const html = `
      <div class="day">
        <div class="date">${label(d)}</div>
        <div class="slot"><b>AM</b> <span class="names">${am || '<span class="empty">—</span>'}</span></div>
        <div class="slot"><b>PM</b> <span class="names">${pm || '<span class="empty">—</span>'}</span></div>
      </div>`;
    cols[(d.getDay()+6)%7].push(html); // Mon-first
  }

  const board = document.getElementById('board');
  const dow=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  board.innerHTML = dow.map((w,i)=>`
    <div class="col">
      <h3>${w}</h3>
      ${cols[i].join('')}
    </div>
  `).join('');
})();
</script>
</body>
</html>
