<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ShiftCommander â€¢ Wallboard</title>
<style>
  :root{ --bg:#0c0f14; --panel:#141a22; --ring:#314056; --ink:#e8eef7; --muted:#8aa; --need:#d9a400; --ok:#18a957; }
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.35 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--ring);background:linear-gradient(180deg,var(--panel),#0f141b)}
  h1{margin:0;font-size:18px;font-weight:700}
  .tabs{margin-left:auto;display:flex;gap:6px}
  .tab{padding:6px 10px;border:1px solid var(--ring);border-radius:999px;background:transparent;color:#c5cfdb;text-decoration:none}
  .tab.active{background:var(--ring);color:var(--ink)}
  .wrap{padding:14px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
  .card{position:relative;border:1px solid var(--ring);background:#10161d;border-radius:12px;padding:10px;min-height:96px}
  .date{font-weight:700;margin-bottom:6px}
  .line{border:1px dashed #2b394b;border-radius:8px;padding:6px 8px;margin-top:6px}
  .assignees{color:#cdd6e2}
  .nudge{position:absolute;top:8px;right:8px;display:inline-block;width:10px;height:10px;border-radius:999px;background:var(--need)}
  .nudge.ok{background:var(--ok)}
  .needtxt{position:absolute;top:6px;right:22px;color:#f3d76c;font-size:12px}
</style>
</head>
<body>
<header>
  <h1>ShiftCommander <span style="color:var(--muted);font-weight:600;margin-left:6px;">Public (read-only)</span></h1>
  <nav class="tabs">
    <a class="tab" href="/member.html">Member</a>
    <a class="tab" href="/supervisor.html">Supervisor</a>
    <a class="tab active" href="/wallboard.html">Wallboard</a>
  </nav>
</header>

<div class="wrap">
  <div id="grid" class="grid"></div>
</div>

<script>
(async () => {
  const API = 'https://adr-fr-scheduler-api.brian-9ac.workers.dev';
  const grid = document.getElementById('grid');

  const [state, users] = await Promise.all([
    fetch(API + '/api/state?start=' + spanStart() + '&end=' + spanEnd()).then(r=>r.json()),
    fetch(API + '/api/users').then(r=>r.json())
  ]);

  const userById = Object.fromEntries(users.map(u => [u.id, u]));

  const dates = Object.keys(state.shifts).sort();
  for(const d of dates){
    const card = document.createElement('div');
    card.className = 'card';

    const needInfo = computeNeed(state.shifts[d], userById);
    const nudge = document.createElement('span');
    nudge.className = 'nudge' + (needInfo.ok ? ' ok' : '');
    card.appendChild(nudge);
    if(!needInfo.ok){
      const t = document.createElement('span');
      t.className = 'needtxt';
      t.textContent = needInfo.text;
      card.appendChild(t);
    }

    const dateEl = document.createElement('div');
    dateEl.className = 'date';
    dateEl.textContent = new Date(d+'T00:00:00').toLocaleDateString
