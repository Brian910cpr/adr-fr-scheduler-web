<!-- wallboard.html — 4 seats per day, bold Nudge, big weekday + date -->
<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ShiftCommander · Wallboard</title>
<style>
:root{--bg:#0b0f14;--ink:#e6edf3;--muted:#9aa4af;--panel:#0f141a;--line:#1f2730;--pill:#1b2430;--accent:#f0b429}
html,body{background:var(--bg);color:var(--ink);margin:0;font:16px/1.4 system-ui,Segoe UI,Roboto,Arial}
.wrap{max-width:1500px;margin:10px auto;padding:0 10px}
.header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
.header h1{margin:0;font-size:22px}
.board{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
.col{background:var(--panel);border:1px solid var(--line);border-radius:16px;overflow:hidden}
.col h3{margin:0;padding:8px 10px;background:#111823;border-bottom:1px solid var(--line);font-size:18px}
.day{padding:10px 12px;border-top:1px dashed var(--line)}
.dateBig{font-weight:900;font-size:22px;margin-bottom:6px}
.slot{margin:6px 0}
.badge{display:inline-block;min-width:44px;text-align:center;background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:2px 8px;font-weight:800;margin-right:8px}
.seat{display:inline-block;min-width:70px;padding:2px 6px;border-radius:8px;margin:2px 2px;border:1px solid var(--line);background:#121922}
.empty{color:var(--muted);font-style:italic}
.nudge{color:var(--accent);font-weight:900;margin-top:6px}
</style>
</head><body><div class="wrap">
  <div class="header"><h1>ShiftCommander Wallboard</h1></div>
  <div id="board" class="board"></div>
</div>
<script>
const API=(p)=>`https://adr-fr-scheduler-api.brian-9ac.workers.dev${p}`;
function fmt(d){return d.toISOString().slice(0,10)}
function dow(d){return d.toLocaleDateString(undefined,{weekday:'short'})}
function label(d){return d.toLocaleDateString(undefined,{month:'short',day:'numeric'})}

async function getUsers(){ const r=await fetch(API('/api/users')); return await r.json(); }
async function getWindow(){
  const start=new Date(); const end=new Date(); end.setDate(start.getDate()+13);
  const r=await fetch(API(`/api/state?start=${fmt(start)}&end=${fmt(end)}`)); return await r.json();
}

function seats(names){
  // up to 4 seats
  const arr = (names||[]).slice(0,4);
  const pads = 4 - arr.length;
  return arr.map(n=>`<span class="seat">${n}</span>`).join('') +
         (pads>0 ? Array.from({length:pads}).map(()=>`<span class="seat empty">—</span>`).join('') : '');
}

function needNudge(amNames, pmNames){
  // example: if either list missing ALS/EMT context, we just show generic "NEED ALS & EMT" when both empty
  if ((amNames.length===0) && (pmNames.length===0)) return "NEED ALS & EMT";
  if (amNames.length===0 && pmNames.length>0) return "AM needs crew";
  if (pmNames.length===0 && amNames.length>0) return "PM needs crew";
  return "";
}

(async function(){
  const users = await getUsers();
  const id2name = Object.fromEntries(users.map(u=>[u.id,u.name]));
  const data = await getWindow();
  const start=new Date(); const cols=[[],[],[],[],[],[],[]];

  for(let i=0;i<14;i++){
    const d=new Date(start); d.setDate(start.getDate()+i);
    const ymd = fmt(d);
    const s = data.shifts?.[ymd] || {};
    const amIds = (s.AM?.assignees||[]);
    const pmIds = (s.PM?.assignees||[]);
    const amNames = amIds.map(id=>id2name[id]);
    const pmNames = pmIds.map(id=>id2name[id]);
    const nudge = needNudge(amNames, pmNames);

    const html = `
      <div class="day">
        <div class="dateBig">${dow(d)} · ${label(d)}</div>
        <div class="slot"><span class="badge">AM</span>${seats(amNames)}</div>
        <div class="slot"><span class="badge">PM</span>${seats(pmNames)}</div>
        ${ nudge ? `<div class="nudge">${nudge}</div>` : `` }
      </div>`;
    cols[(d.getDay()+6)%7].push(html);
  }

  const board = document.getElementById('board');
  const dowLabels = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  board.innerHTML = dowLabels.map((w,i)=>`
    <div class="col">
      <h3>${w}</h3>
      ${cols[i].join('')}
    </div>
  `).join('');
})();
</script>
</body></html>
