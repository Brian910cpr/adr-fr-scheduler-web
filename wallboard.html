<!-- wallboard.html â€” paste this just before </body> -->
<script>
/* Reuse SCHED client if present */
if(!window.SCHED){
  window.SCHED=(function(){
    const API="https://adr-fr-scheduler-api.brian-9ac.workers.dev";
    async function fetchState({start,end}){ const r=await fetch(`${API}/api/state?start=${start}&end=${end}`); if(!r.ok)throw new Error("state fetch failed"); return r.json(); }
    async function health(){ const r=await fetch(`${API}/api/health`); return r.json(); }
    return {fetchState, health};
  })();
}
</script>
<script>
// ================= PUBLIC WALLBOARD WIRING =================
// Keeps current visuals; fills up to 4 names; larger date/dow.

(function(){
  const MAX_SEATS = 4;

  const style = document.createElement("style");
  style.textContent = `
    .wb-date { font-size: clamp(22px, 3vw, 38px); font-weight:800; letter-spacing:.3px; }
    .wb-dow { font-size: clamp(16px, 2.2vw, 26px); font-weight:700; opacity:.9; }
    .wb-names { display:grid; grid-template-rows: repeat(${MAX_SEATS}, 1fr); gap:2px; }
    .wb-names .name { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  `;
  document.head.appendChild(style);

  function idToName(id){ return (window.USER_LABELS && window.USER_LABELS[id]) || id; }

  function fillHalf(halfBox, assignees){
    const wrap = halfBox.querySelector(".wb-names") || document.createElement("div");
    wrap.className = "wb-names";
    wrap.innerHTML = "";
    (assignees||[]).slice(0,MAX_SEATS).forEach(id=>{
      const row = document.createElement("div");
      row.className = "name";
      row.textContent = idToName(id);
      wrap.appendChild(row);
    });
    if(!halfBox.querySelector(".wb-names")) halfBox.appendChild(wrap);
  }

  async function paint(){
    const days = Array.from(document.querySelectorAll(".wb-day[data-date]"));
    if(!days.length) return;
    const dates = days.map(d=>d.dataset.date).sort();
    const start = dates[0], end = dates[dates.length-1];

    let data;
    try{ data = await SCHED.fetchState({ start, end }); }
    catch(e){ console.error("state fetch failed", e); return; }

    days.forEach(day=>{
      const d = day.dataset.date;
      const s = (data.shifts && data.shifts[d]) || { AM:{assignees:[]}, PM:{assignees:[]} };
      const am = day.querySelector(".wb-am");
      const pm = day.querySelector(".wb-pm");
      if(am) fillHalf(am, s.AM.assignees||[]);
      if(pm) fillHalf(pm, s.PM.assignees||[]);
    });
  }

  (async function(){
    try{ await SCHED.health(); }catch(e){}
    paint();
  })();
})();
</script>
